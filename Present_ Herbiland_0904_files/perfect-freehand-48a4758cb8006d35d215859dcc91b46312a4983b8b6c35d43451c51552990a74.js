!function(){function t(t,n){return[t[0]+n[0],t[1]+n[1]]}function n(t,n){return[t[0]-n[0],t[1]-n[1]]}function e(t,n){return[n[0]-t[0],n[1]-t[1]]}function r(t,n){return[t[0]*n,t[1]*n]}function i(t,n){return[t[0]/n,t[1]/n]}function u(t){return[t[1],-t[0]]}function o(t,n){return t[0]*n[0]+t[1]*n[1]}function s(t){return Math.hypot(t[0],t[1])}function p(t){return t[0]*t[0]+t[1]*t[1]}function l(t,e){return p(n(t,e))}function h(t){return i(t,s(t))}function f(t,n){return Math.hypot(t[1]-n[1],t[0]-n[0])}function c(n,e){return r(t(n,e),.5)}function a(t,n,e){let r=Math.sin(e),i=Math.cos(e),u=t[0]-n[0],o=t[1]-n[1],s=u*r+o*i;return[u*i-o*r+n[0],s+n[1]]}function g(n,i,u){return t(n,r(e(n,i),u))}function m(t,n){return t[0]===n[0]&&t[1]===n[1]}function M(t,n,e){return t*(1-e)+n*e}function d(t,n,e){return Math.max(n,Math.min(e,t))}function v(t){return Array.isArray(t[0])?t.map(([t,n,e=.5])=>[t,n,e]):t.map(({x:t,y:n,pressure:e=.5})=>[t,n,e])}function L(t,n,e,r=.5){return n?(r=d(e(r),0,1),(n<0?M(t,t+t*d(n,-.95,-.05),r):M(t-t*d(n,.05,.95),t,r))/2):t/2}function y(e,r={}){let{streamline:i=.5}=r,{simulatePressure:u=!0}=r;i/=u?4:2;let o=v(e);if(0===o.length)return[];1===o.length&&o.push([...t(o[0],[1,1]),o[0][2]]);let s=[{point:[o[0][0],o[0][1]],pressure:o[0][2],vector:[0,0],distance:0,runningLength:0}];for(let t=1,e=0,r=o[t],u=s[e];t<o.length;r=o[++t],u=s[e]){let t=g(u.point,r,1-i);if(m(u.point,t))continue;let o=h(n(u.point,t)),p=f(t,u.point),l=u.runningLength+p,c={point:t,pressure:r[2],vector:o,distance:p,runningLength:l};s.push(c),e+=1}return s}function x(i,s={}){let{size:p=8,thinning:M=.5,smoothing:d=.5,simulatePressure:v=!0,easing:y=(t=>t),start:x={},end:P={},last:b=!1}=s,{streamline:A=.5}=s;A/=2;let{cap:z=!0,taper:F=0,easing:I=(t=>t*(2-t))}=x,{cap:S=!0,taper:j=0,easing:q=(t=>--t*t*t+1)}=P,B=i.length;if(0===B)return[];let C,D=i[B-1].runningLength,E=[],G=[],H=i.slice(0,5).reduce((t,n)=>(t+n.pressure)/2,i[0].pressure),J=L(p,M,y,i[B-1].pressure),K=i[0].vector,N=i[0].point,O=N,Q=N,R=O,T=!0;for(let e=0;e<B-1;e++){let{pressure:s}=i[e],{point:h,vector:f,distance:c,runningLength:m}=i[e];if(e>0&&T&&m<p/2)continue;if(T&&(T=!1),M){if(v){let t=k(1,1-c/p),n=k(1,c/p);s=k(1,H+n/2*(t-H))}J=L(p,M,y,s)}else J=p/2;void 0===C&&(C=J);let x=m<F?I(m/F):1,P=D-m<j?q((D-m)/j):1;J=Math.max(.01,J*Math.min(x,P));let b=i[e+1].vector,z=o(f,b);if(z<0){let e=r(u(K),J);for(let r=0;r<1;r+=.2)R=a(t(h,e),h,w*-r),Q=a(n(h,e),h,w*r),G.push(R),E.push(Q);N=Q,O=R;continue}let S=r(u(g(b,f,z)),J);Q=n(h,S),R=t(h,S);let B=e<2||z<.25,U=Math.pow(Math.max((m>p?p:p/2)*d,1),2);(B||l(N,Q)>U)&&(E.push(g(N,Q,A)),N=Q),(B||l(O,R)>U)&&(G.push(g(O,R,A)),O=R),H=s,K=f}let U=i[0],V=i[B-1],W=T||G.length<2||E.length<2;if(W&&(!F&&!j||b)){let t=0;for(let n=0;n<B;n++){let{pressure:e,runningLength:r}=i[n];if(r>p){t=L(p,M,y,e);break}}let o=n(U.point,r(u(h(e(V.point,U.point))),t||J)),s=[];for(let t=0,n=.1;t<=1;t+=n)s.push(a(o,U.point,2*w*t));return s}let X=[],Y=[];if(E.length>1&&G.length>1){R=G[1];for(let t=1;t<E.length;t++)if(!m(R,E[t])){Q=E[t];break}if(z||F){if(F||j&&W)X.push(U.point,t(U.point,[.1,.1]));else if(!m(R,Q)){let t=n(U.point,r(h(e(R,Q)),f(R,Q)/2));for(let n=0,e=.1;n<=1;n+=e)X.push(a(t,U.point,w*n));E.shift(),G.shift()}}else if(!m(R,Q)){let i=h(e(R,Q)),u=f(R,Q)/2;X.push(n(U.point,r(i,.95*u))),X.push(n(U.point,r(i,u))),X.push(t(U.point,r(i,u))),X.push(t(U.point,r(i,.95*u))),E.shift(),G.shift()}let i=c(E[E.length-1],G[G.length-1]),o=s.last?V.point:g(i,V.point,.618),p=h(n(o,i));if(S||j)if(j||F&&W)Y.push(o);else{let n=t(o,r(u(p),J));for(let t=0,e=.15;t<=1;t+=e)Y.push(a(n,o,3*w*t))}else{let e=g(i,o,.95),s=.95*J;Y.push(t(e,r(u(p),s))),Y.push(t(o,r(u(p),s))),Y.push(n(o,r(u(p),s))),Y.push(n(e,r(u(p),s)))}}return E.concat(Y,G.reverse(),X)}function P(t,n={}){return x(y(t,n),n)}var{min:k,PI:w}=Math;window.PerfectFreehand={getStroke:P}}();